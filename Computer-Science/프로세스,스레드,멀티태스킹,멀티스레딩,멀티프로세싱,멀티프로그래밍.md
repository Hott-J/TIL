# 여러 프로그램이 동시에 실행되는 원리



## 프로그램

- 컴퓨터가 실행할 수 있는 명령어들의 집합



## 프로세스

- 컴퓨터에서 실행 중인 프로그램

- 각각의 프로세스는 **독립된 메모리 공간**을 할당 받음

- 명령어들과 데이터를 가짐



## CPU

- 명령어를 실행하는 연산 장치



## 메인 메모리

- 프로세스가 CPU에서 실행되기 위해 대기하는 곳



## IO (input/output)

-  파일을 읽고 쓰거나 
- 네트워크의 어딘가와 데이터를 주고 받는 것
- 입출력 장치와 데이터를 주거나 받는 것



## 단일 프로세스 시스템

- 한 번에 하나의 프로그램만 실행됨

단점

- CPU 사용률이 좋지 않음
  - 실행중인 하나의 프로세스가 I/O 작업을 하러가는 동안 CPU는 논다

해결책

- 여러 개의 프로그램을 메모리에 올려놓고 동시에 실행시키자!
  - 하나의 프로세스가 I/O 작업이 발생하면 다른 프로세스가 CPU에서 실행됨

이런 종류의 시스템을 멀티프로그래밍이라 함



## 멀티프로그래밍

- CPU 사용률을 극대화

단점

- CPU 사용 시간이 길어지면 다른 프로세스는 계속 대기

해결책

- 프로세스는 한번 CPU를 사용할 때 아주 짧은 시간(=quantum)만 CPU에서 실행되도록 하자!

예제

- P1, P2를 짧게 쪼개서 번갈아서 실행시킨다

이런 종류의 시스템을 멀티태스킹이라 함



## 멀티태스킹

- 프로세스의 응답 시간을 최소화 시키는데 목적
  - 마치 여러 프로그램이 동시에 실행되고있다고 느껴짐

- 타임시간을 아주 짧게 쪼개서 여러 프로세스들을 그만큼 쪼개서 교대로 실행하여 동시에 실행되고 있는 듯한 느낌

아쉬운점1

- 하나의 프로세스가 동시에 여러 작업을 수행하지는 못함 (여러 프로세스가 동시에 실행되는건 지원)

아쉬운점2

- 프로세스의 컨텍스트 스위칭은 무거운 작업
  - 컨텍스트 스위칭: P1 -> P2

아쉬운점3

- 프로세스끼리 데이터 공유가 까다로움
  - 프로세스는 독립된 메모리 공간을 갖고 있기 때문에
  - IPC

아쉬운점4

- 듀얼 코어가 등장했는데 잘 쓰고 싶음
  - 하나의 CPU성능을 개선시키는 것은 발열등 이슈로 문제됨
  - 한 CPU안에 두개의 코어를 둬서 전체적인 성능을 높힘

해결책

- 스레드!



## 스레드 (OS level)

- 프로세스는 한 개 이상의 스레드를 가질 수 있다
- 한 프로세스 안에서 여러 개의 작업을 동시에 실행시켜준다
  - 아쉬운점1 해결
- CPU에서 실행되는 단위
  - 프로세스가 CPU에서 실행되는 단위 (옛날)
  - 스레드가 CPU에서 실행되는 단위 (현재)
- 같은 프로세스의 스레드들끼리 컨텍스트 스위칭은 가볍다
  - 아쉬운점2 해결
- 스레드들은 자신들이 속한 프로세스의 메모리 영역을 공유
  - 아쉬운점3 해결
- 메모리 구조 비교 (싱글 스레드 vs 멀티 스레드)

![image](https://user-images.githubusercontent.com/47052106/169986340-45ea641d-3fa8-4229-b003-cf8228b39f30.png)

- 왼쪽은 싱글 스레드면서 스레드 나오기 이전 프로세스 구조라 봐도 무방함
- 오른쪽은 멀티 스레드들이 소속된 프로세스 영역
  - 힙을 공유함
  - 스택은 공유하지 않음 (스택: 스레드 자신만의 고유한 영역)
  - SP와 PC는 각각 갖고 있음
    - PC: 다음번 실행되야될 명령어가 있는 메모리 주소를 가리킴

예제

- 코어 1개

- ![image](https://user-images.githubusercontent.com/47052106/169987152-3174ed37-0214-450a-b587-9829ff8e0c6e.png)

  - 하나의 CPU 안에 하나의 코어, 하나의 프로세스

  - 두 개의 스레드를 잘게 쪼개서 번갈아 실행 (컨텍스트 스위칭)

- 코어 2개

- ![image](https://user-images.githubusercontent.com/47052106/169987454-9e1291a2-a9c1-45d7-a211-a70e722785cb.png)

  - 하나의 CPU 안에 두개의 코어, 하나의 프로세스

  - 스레드들이 각각 코어에 매핑, 진정한 동시에 실행됨. 병렬적으로

- 이런 종류의 시스템을 멀티 스레딩이라 함



## 멀티 스레딩

- 하나의 프로세스가 동시에 여러 작업을 실행하는데 목적

- 스레드가 등장하면서 확장된 멀티태스킹 개념
  - 여러 프로세스와 여러 스레드가 아주 짧게 쪼개진 cpu time을 나눠 갖는 것

- 두 개 이상의 프로세서나 코어를 활용하는 시스템을 멀티프로세싱이라 함
- 공유 자원을 잘 관리해야함



예제) 싱글코어 CPU에 싱글-스레드 프로세스 두 개

- 멀티태스킹O
  - 프로세스 2개가 하나의 CPU를 나눠써야하므로
- 멀티스레딩X
- 멀티프로세싱X



예제) 싱글코어 CPU에 듀얼-스레드 프로세스 한 개

- 멀티태스킹O
  - CPU 하나를 나눠써야함
- 멀티스레딩O
  - 듀얼 스레드
- 멀티프로세싱X
  - CPU가 하나



예제) 듀얼코어 CPU에 싱글-스레드 프로세스 두 개

- 멀티태스킹X
  - CPU를 나눠쓰지 않음
- 멀티스레딩X
- 멀티프로세싱O



예제) 듀얼코어 CPU에 듀얼-스레드 프로세스 한 개

- 멀티태스킹X
- 멀티스레딩O
- 멀티프로세싱O



예제) 듀얼코어 CPU에 듀얼-스레드 프로세스 두 개

- 멀티태스킹O
  - 코어 하나당 두개의 스레드가 경합
- 멀티스레딩O
- 멀티프로세싱O

![image](https://user-images.githubusercontent.com/47052106/169989464-7f33f147-cc4c-42b2-864b-c8cbf438cc91.png)

![image](https://user-images.githubusercontent.com/47052106/169989649-4657c4da-3325-4ad5-9bb1-965240edaa60.png)