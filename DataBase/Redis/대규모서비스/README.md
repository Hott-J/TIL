## 대규모 서비스



### 대규모서비스란?

- 많은 사용자 트래픽
- 많은 사용자 데이터
- 사용자 트래픽 / 데이터의 빠른 증가



Facebook

- 2012년 기준 하루에 500+TB 데이터



스타트 업에서 서비스의 인기가 좋아 트래픽이 감당할 수 없을 정도로 늘어난다면? 

몇일 동안 서비스가 안된다면 어떤일이 벌어지는가?

우리가 만드는 서비스는 앞에서 소개한 예의 트래픽/데이터 증가에도 문제없이 서비스가 가능할까?



대규모 서비스가 가져야 할 특성

- 확장성
  - 서비스의 가용용량을 늘이고 줄이는 것이 쉬어야한다
  - 서버를 추가하고 감소하고 (트래픽에 따라)
  - 추가되어야하는 서버는? 쉽게 될까?
    - 웹서버, 디비서버
  - 제거되어야하는 서버는? 쉽게 될까?
    - 웹서버, 디비서버
- 장애회복성
  - 서비스에 장애가 일어났을 때 가능한 메뉴얼한 처리 없이 자동적으로 회복되어야 한다
  - failvoer
  - replication
  - 장애회복성을 위해서는  SPOF가 없어야 한다
  - SPOF?
    - Single Point of Failure
    - 해당 지점에 장애가 발생하면 전체 서비스에 장애를 낼 수 있는 부분 (디비서버, 인증서버 -> 이게 고장나면 전체 서비스를 이용못함)
  - 한대의 물리 서버는 무조건 SPOF가 존재
  - SPOF를 제거하려면?
    - API 서버를 늘려보자 (API 서버가 한대 장애 나도 서비스가 가능) 
    - DB 서버도 늘려주자 (Replication)
    - SPOF가 한군데라도 있으면 문제가 발생함. 그러므로 API서버, DB 서버 둘다 최소 이중화되어야한다.
  - 이외에도 SPOF가 발생할 수 있는 부분들
    - Switch, Route등의 서버 외의 하드웨어 부분
      - 전용선이 끊기는 경우도 발생
  - Network의 Bandwidth 한계
    - Swich의 한계 (서버는 스위치에 물려있음)
    - 스위치가 10G bandwidth면 총 서버는 10G 이상의 데이터가 전달될 수 없고, 10G이상의 데이터가 온다면 패킷 드랍 발생
    - 스위치가 장애나면 스위치와 연결된 모든 서버 장애 -> 스위치도 이중화 (하드웨어 장비들도)
  -  SPOF를 최대한 제거하고, 각 부분들을 확장할 수 있어야 한다
- 자동화
  - 배포부터 장애처리 등 대부분 자동화 되어서 버튼 클릭 한 두번 정도로 진행되어야 한다
  - 사람이 손으로 직접 건드리는 것은 도리어 새로운 장애의 씨앗이 된다
  - IaC (infrastructure as code)가 중요함
- 모니터링
  - 서비스 상태는 항상 모니터링되어야 한다